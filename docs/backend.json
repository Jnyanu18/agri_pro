{
  "entities": {
    "User": {
      "title": "User",
      "type": "object",
      "description": "Represents a user profile with associated farm metadata.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "numPlants": {
          "type": "number",
          "description": "Number of plants in the user's farm."
        },
        "district": {
          "type": "string",
          "description": "District where the user's farm is located."
        },
        "language": {
          "type": "string",
          "description": "Preferred language of the user."
        }
      },
      "required": [
        "id"
      ]
    },
    "Plant": {
      "title": "Plant",
      "type": "object",
      "description": "Represents per-image inference data for a plant, including detections, stage counts, and yield estimations.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Plant)"
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the image associated with the plant."
        },
        "detections": {
          "type": "array",
          "description": "Array of tomato detections in the image.",
          "items": {
            "type": "object",
            "properties": {
              "x1": { "type": "number" },
              "y1": { "type": "number" },
              "x2": { "type": "number" },
              "y2": { "type": "number" },
              "conf": { "type": "number" }
            }
          }
        },
        "stageCounts": {
          "type": "object",
          "description": "Counts of tomatoes in different growth stages (immature, ripening, mature).",
          "properties": {
            "immature": { "type": "number" },
            "ripening": { "type": "number" },
            "mature": { "type": "number" }
          }
        },
        "growthStage": {
          "type": "string",
          "description": "Overall growth stage of the plant."
        },
        "modelVersion": {
          "type": "string",
          "description": "Version of the model used for inference."
        },
        "yieldNowKg": {
          "type": "number",
          "description": "Estimated current yield in kilograms."
        },
        "sellableKg": {
          "type": "number",
          "description": "Estimated sellable yield in kilograms."
        },
        "readyCurve": {
          "type": "array",
          "description": "Curve representing the readiness of tomatoes for harvest over time.",
          "items": {
            "type": "object",
            "properties": {
              "date": { "type": "string" },
              "readyKg": { "type": "number" }
            }
          }
        },
        "harvestPlan": {
          "type": "array",
          "description": "Plan for harvesting tomatoes, including dates and quantities.",
           "items": {
            "type": "object",
            "properties": {
              "date": { "type": "string" },
              "kg": { "type": "number" }
            }
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the plant data was created.",
          "format": "date-time"
        }
      },
      "required": [
        "uid",
        "imageUrl",
        "createdAt"
      ]
    },
    "Feedback": {
      "title": "Feedback",
      "type": "object",
      "description": "Represents farmer feedback on plant data, including corrections and notes.",
      "properties": {
        "plantId": {
          "type": "string",
          "description": "Reference to Plant. (Relationship: Plant 1:N Feedback)"
        },
        "uid": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Feedback)"
        },
        "missedCount": {
          "type": "number",
          "description": "Number of tomatoes missed by the detection model."
        },
        "wrongStage": {
          "type": "string",
          "description": "Indication of incorrect growth stage classification."
        },
        "notes": {
          "type": "string",
          "description": "Additional notes from the farmer."
        },
        "boxLabels": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Box label array from the farmer."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the image associated with the feedback."
        }
      },
      "required": [
        "plantId",
        "uid"
      ]
    },
    "MarketPrice": {
      "title": "MarketPrice",
      "type": "object",
      "description": "Represents market prices for tomatoes in a specific district and date.",
      "properties": {
        "district": {
          "type": "string",
          "description": "District for which the market price is recorded."
        },
        "date": {
          "type": "string",
          "description": "Date for which the market price is recorded.",
          "format": "date-time"
        },
        "price": {
          "type": "number",
          "description": "Market price of tomatoes."
        }
      },
      "required": [
        "district",
        "date",
        "price"
      ]
    },
    "DailyMetrics": {
      "title": "DailyMetrics",
      "type": "object",
      "description": "Represents daily key performance indicators (KPIs) for the tomato yield prediction system.",
      "properties": {
        "date": {
          "type": "string",
          "description": "Date for which the metrics are recorded.",
          "format": "date-time"
        },
        "mAP50_95": {
          "type": "number",
          "description": "Mean average precision at IoU thresholds between 0.50 and 0.95."
        },
        "avgConf": {
          "type": "number",
          "description": "Average confidence score of the detection model."
        },
        "yieldMAE": {
          "type": "number",
          "description": "Mean absolute error in yield estimation."
        },
        "imagesProcessed": {
          "type": "number",
          "description": "Number of images processed by the system."
        }
      },
      "required": [
        "date",
        "mAP50_95",
        "avgConf",
        "yieldMAE",
        "imagesProcessed"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "/users/{uid}": {
      "schema": {
        "$ref": "#/entities/User"
      },
      "description": "Stores user profiles and farm metadata. Each document is uniquely identified by the user's UID."
    },
    "/plants/{plantId}": {
      "schema": {
        "$ref": "#/entities/Plant"
      },
      "description": "Stores per-image inference data for each plant. Includes denormalized 'uid' field for authorization independence."
    },
    "/feedback/{feedbackId}": {
      "schema": {
        "$ref": "#/entities/Feedback"
      },
      "description": "Stores farmer feedback on plant data. Includes denormalized 'uid' field for authorization independence."
    },
    "/market/{district}/{date}": {
      "schema": {
        "$ref": "#/entities/MarketPrice"
      },
      "description": "Stores cached market prices for tomatoes by district and date."
    },
    "/metrics/{yyyymmdd}": {
      "schema": {
        "$ref": "#/entities/DailyMetrics"
      },
      "description": "Stores daily KPIs for the tomato yield prediction system. Data only written via Cloud Functions."
    }
  }
}
